<!DOCTYPE html><html>
        <head>
        <title>CMSiMDE</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400,500,700,900" rel="stylesheet">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/icomoon/style.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/magnific-popup.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/jquery-ui.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.carousel.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/aos.css">
        <link rel="stylesheet" href="./../cmsimde/static/chimper/css/style.css">
        <link rel="shortcut icon" href="./../cmsimde/static/favicons.png">
        
        <style type='text/css'>
            .site-section {
            background-color: #FFFF;
            padding: 40px 40px;
            }
            body > div > div.dropdown.open {
                display: block;
            }
        </style>
    
        <!-- <script src="./../cmsimde/static/jquery.js"></script> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
        <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/normalize.min.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch_set.js"></script>
        <script src="tipuesearch_content.js"></script>
        <link rel="stylesheet" href="./../cmsimde/static/tipuesearch/css/tipuesearch.css">
        <script src="./../cmsimde/static/tipuesearch/tipuesearch.js"></script>
        <script>
            /* original tipuesearch
            $(document).ready(function() {
                 $('#tipue_search_input').tipuesearch();
            });
            */
            // customed doSearch
            function doSearch() {
                $('#tipue_search_input').tipuesearch({
                    newWindow: true, 
                    minimumLength: 2,
                    wholeWords: false, // for search 中文
                });
            }
            $(document).ready(doSearch);
        </script>
        
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushBash.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDiff.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushHaxe.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushCSharp.js"></script>
<script type="text/javascript" src="./../cmsimde/static/syntaxhighlighter/shBrushDart.js"></script>
<link type="text/css" rel="stylesheet" href="./../cmsimde/static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 暫時不用
<script src="./../cmsimde/static/fengari-web.js"></script>
<script type="text/javascript" src="./../cmsimde/static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../cmsimde/static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.add_border {
    border: 3px solid blue;
}
</style>

</head>
<body>
<div class='container'><nav>
        
    <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>
    
            <header class="site-navbar py-4 bg-white" role="banner">
              <div class="container-fluid">
                <div class="row align-items-center">
                <h1>40823125 協同產品設計實習</h1>
                <div class="pl-4">
                    <form>
                    <input type="text" placeholder="Search" name="q" id="tipue_search_input" pattern=".{2,}" title="At least 2 characters" required>
                    </form>
                </div>
                  <!-- <div class="col-11 col-xl-2">
                    <h1 class="mb-0 site-logo"><a href="index.html" class="text-black h2 mb-0">40823125 協同產品設計實習</a></h1> 
                  </div>
                  -->
                  <div class="col-12 col-md-10 d-none d-xl-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">
    <ul class='site-menu js-clone-nav mr-auto d-none d-lg-block'>
                        <li class="active has-children"><a href="index.html">Home</a>
                        <ul class="dropdown">
                            <li><a href="sitemap.html">Site Map</a></li>
                            <li><a href="./../reveal/index.html">reveal</a></li>
                            <li><a href="./../blog/index.html">blog</a></li>
                        </ul>
                      </li>
                     <li><a href='個人簡介.html'>個人簡介</a><li class='has-children'><a href='Stage1-ag14.html'>Stage1-ag14</a><ul class='dropdown'><li><a href='W1.html'>W1</a><li class='has-children'><a href='W2.html'>W2</a><ul class='dropdown'><li><a href='零件尺寸及示意圖.html'>零件尺寸及示意圖</a><li><a href='分組開會紀錄.html'>分組開會紀錄</a></li></ul><li class='has-children'><a href='W4.html'>W4</a><ul class='dropdown'><li><a href='PDF.html'>PDF</a></li></li></ul></ul><li class='has-children'><a href='發球機版本.html'>發球機版本</a><ul class='dropdown'><li><a href='第1版.html'>第1版</a><li><a href='第2版.html'>第2版</a><li><a href='第3版.html'>第3版</a><li><a href='第4版.html'>第4版</a><li><a href='第5版.html'>第5版</a></li></ul><li class='has-children'><a href='Stage2-ag12.html'>Stage2-ag12</a><ul class='dropdown'><li><a href='W5.html'>W5</a><li><a href='產品目標.html'>產品目標</a><li class='has-children'><a href='W7.html'>W7</a><ul class='dropdown'><li><a href='Heroku 網站建立.html'>Heroku 網站建立</a></li></ul><li><a href='W9.html'>W9</a></li></ul><li class='has-children'><a href='籃球機版本.html'>籃球機版本</a><ul class='dropdown'><li><a href='版本一.html'>版本一</a><li class='has-children'><a href='版本二.html'>版本二</a><ul class='dropdown'><li><a href='2.1.html'>2.1</a><li><a href='2.2.html'>2.2</a><li><a href='2.3.html'>2.3</a><li><a href='2.4.html'>2.4</a></li></li></ul></ul><li><a href='ssh.html'>ssh</a><li><a href='Error exclude.html'>Error exclude</a><li class='has-children'><a href='stage3-ag6.html'>stage3-ag6</a><ul class='dropdown'><li class='has-children'><a href='task 1.html'>task 1</a><ul class='dropdown'><li><a href='stage3-2a.html'>stage3-2a</a></li></ul><li><a href='task 2.html'>task 2</a><li class='has-children'><a href='W13.html'>W13</a><ul class='dropdown'><li><a href='gogs操作.html'>gogs操作</a></li></ul><li class='has-children'><a href='W14.html'>W14</a><ul class='dropdown'><li><a href='CoppeliaSim 控制程式.html'>CoppeliaSim 控制程式</a></li></ul><li class='has-children'><a href='W15.html'>W15</a><ul class='dropdown'><li><a href='fossil 教學.html'>fossil 教學</a><li><a href='Inverse kinematics for a 2-joint robot arm using geometry.html'>Inverse kinematics for a 2-joint robot arm using geometry</a><li><a href='Inverse kinematics for a 2-joint robot arm using algebra.html'>Inverse kinematics for a 2-joint robot arm using algebra</a></li></ul><li class='has-children'><a href='W16.html'>W16</a><ul class='dropdown'><li><a href='MTB Onshape.html'>MTB Onshape</a><li><a href='建立 CoppeliaSim 4.1.0 MTB robot 場景.html'>建立 CoppeliaSim 4.1.0 MTB robot 場景</a><li><a href='手臂末端加入 components-gripper-suction pad 吸盤.html'>手臂末端加入 components-gripper-suction pad 吸盤</a><li><a href='逆向運動學函式.html'>逆向運動學函式</a><li><a href='Python remote API 逆向運動學函式.html'>Python remote API 逆向運動學函式</a></li>
                      </ul>
                </nav>
              </div>
              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black"><span class="icon-menu h3"></span></a></div>
              </div>

            </div>
          </div>
          
        </header>
    <div id="tipue_search_content">手臂末端加入 components-gripper-suction pad 吸盤 << <a href='手臂末端加入 components-gripper-suction pad 吸盤.html'>Previous</a> <a href='Python remote API 逆向運動學函式.html'>Next</a> >> Python remote API 逆向運動學函式<br /><h1>逆向運動學函式</h1>
<p><span>使用老師的逆運動學函式求出終點位置的位移，使MTB_robot在coppeliasim裡可以順利達到老師要求的位置</span></p>
<p><span><a href="https://drive.google.com/file/d/18gWlnhcRQj3uRjgt2QCEbnUu60jNp4Sr/view?usp=sharing">MTB_force mode.7z</a></span></p>
<p><strong>第一版:</strong></p>
<p><span><iframe allowfullscreen="allowfullscreen" height="314" src="//www.youtube.com/embed/J0m9TPJ3oR8" width="560"></iframe></span></p>
<p><strong>第二版:</strong></p>
<p><strong><iframe allowfullscreen="allowfullscreen" height="314" src="//www.youtube.com/embed/dp8DqVPdMtE" width="560"></iframe></strong></p>
<p><strong>Mtb_robot_keyboard.lua:</strong></p>
<pre class="brush:lua;auto-links:false;toolbar:false" contenteditable="false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- Created by Leo: http://leoeditor.com/leo_toc.html --&gt;
&lt;leo_file xmlns:leo="http://leoeditor.com/namespaces/leo-python-editor/1.1" &gt;
&lt;leo_header file_format="2"/&gt;
&lt;globals/&gt;
&lt;preferences/&gt;
&lt;find_panel_settings/&gt;
&lt;vnodes&gt;
&lt;v t="leo.20210526153741.1"&gt;&lt;vh&gt;@settings&lt;/vh&gt;
&lt;v t="leo.20210526153741.2"&gt;&lt;vh&gt;@data qt-gui-plugin-style-sheet&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210526153741.3"&gt;&lt;vh&gt;@string initial_split_orientation = horizontal&lt;/vh&gt;&lt;/v&gt;
&lt;/v&gt;
&lt;v t="leo.20210526155936.1"&gt;&lt;vh&gt;About W16 task&lt;/vh&gt;
&lt;v t="leo.20210529151306.1"&gt;&lt;vh&gt;mtbrobot_w16&lt;/vh&gt;&lt;/v&gt;
&lt;/v&gt;
&lt;v t="leo.20210529215420.1"&gt;&lt;vh&gt;force sensor&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155453.1"&gt;&lt;vh&gt;recursive importer&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.1"&gt;&lt;vh&gt;imported files&lt;/vh&gt;
&lt;v t="leo.20210529155606.2"&gt;&lt;vh&gt;@path ./&lt;/vh&gt;
&lt;v t="leo.20210529155606.8"&gt;&lt;vh&gt;@clean Mtb_robot_keyboard.lua&lt;/vh&gt;
&lt;v t="leo.20210529155606.9"&gt;&lt;vh&gt;sysCall_init&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.10"&gt;&lt;vh&gt;sysCall_actuation&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.11"&gt;&lt;vh&gt;sysCall_sensing&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.12"&gt;&lt;vh&gt;sysCall_cleanup&lt;/vh&gt;&lt;/v&gt;
&lt;/v&gt;
&lt;v t="leo.20210615114721.1"&gt;&lt;vh&gt;@clean Mtb_robot_loop.lua&lt;/vh&gt;
&lt;v t="leo.20210615114721.2"&gt;&lt;vh&gt;sysCall_threadmain&lt;/vh&gt;&lt;/v&gt;
&lt;/v&gt;
&lt;v t="leo.20210529155606.18"&gt;&lt;vh&gt;@clean suctionpad.lua&lt;/vh&gt;
&lt;v t="leo.20210529155606.19"&gt;&lt;vh&gt;sysCall_init (suctionpad_w16.lua)&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.20"&gt;&lt;vh&gt;sysCall_cleanup (suctionpad_w16.lua)&lt;/vh&gt;&lt;/v&gt;
&lt;v t="leo.20210529155606.21"&gt;&lt;vh&gt;sysCall_sensing (suctionpad_w16.lua)&lt;/vh&gt;&lt;/v&gt;
&lt;/v&gt;
&lt;/v&gt;
&lt;/v&gt;
&lt;/vnodes&gt;
&lt;tnodes&gt;
&lt;t tx="leo.20210526153741.1"&gt;&lt;/t&gt;
&lt;t tx="leo.20210526153741.2"&gt;QTreeWidget {
    /* These apply to the selected item, but not to editing items.*/
    background-color: #ffffec; /* Leo's traditional tree color */
    selection-color: black; /* was white */
    selection-background-color: lightgrey;
    /* font-family: SansSerif; */
    /*font-family: DejaVu Sans Mono;*/
    font-family:YaHei Mono;
    /* 標題字型大小設定 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal, italic,oblique */
 }

/* Headline edit widgets */
QTreeWidget QLineEdit {
    background-color: cornsilk;
    selection-color: white;
    selection-background-color: blue;
    /*font-family: DejaVu Sans Mono;*/    
    font-family:YaHei Mono;
    /* 沒有特別對應字型大小 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal, italic,oblique */
}

/* The log panes */
QTextEdit {
    background-color: #f2fdff;
    selection-color: red;
    selection-background-color: blue;
    /* font-family: Courier New; */
    font-family:YaHei Mono;
    /* log font 大小 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal, italic,oblique */
}

/* The body pane */
QTextEdit#richTextEdit {
    background-color: #fdf5f5; /* A kind of pink. */
    selection-color: white;
    selection-background-color: red;
    /*font-family: DejaVu Sans Mono;*/
    /* font-family: Courier New; */
    font-family:YaHei Mono;
    /* 內文字型大小 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal,italic,oblique */
}

QLabel {
    font-family:YaHei Mono;'CherryPy', 'pytz', 'mako', 'beautifulsoup4', 'pymysql', 'peewee'
    /* 下方的 Minibuffer 標題字型大小 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal,italic,oblique */
}

/* Editor labels */
QLineEdit#editorLabel {
    background-color: #ffffec;
    font-family:YaHei Mono;
    /* 沒有直接對應字型大小 */
    font-size: 30px;
    font-weight: normal; /* normal,bold,100,..,900 */
    font-style: normal; /* normal,italic,oblique */
    border: 2px;
    margin: 2px;
}&lt;/t&gt;
&lt;t tx="leo.20210526153741.3"&gt;horizontal: body pane to the left
vertical: body pane on the botton&lt;/t&gt;
&lt;t tx="leo.20210526155936.1"&gt;https://www.coppeliarobotics.com/helpFiles/en/robotLanguageIntegrationTutorial.htm

目前 MTB_robot 是一項四軸機械手臂, 採用特殊的指令語言令 robot 移動, 並利用 suction pad 執行 pick and place

請各組設法去除原有的特殊控制語法, 編寫一組通用的 lua 程式完成上述 MTB_robot 取放 block 的操作流程.&lt;/t&gt;
&lt;t tx="leo.20210529151306.1"&gt;將原先透過 plugin 特殊控制語法的場景, 改為直接以 lua 驅動 robot&lt;/t&gt;
&lt;t tx="leo.20210529155453.1"&gt;'''Recursively import all python files in a directory and clean the result.'''
# ctrl + b to execute

c.recursiveImport(
    dir_ = r'./',
    kind = '@clean', # The new best practice.
    safe_at_file = False,
    theTypes = ['.lua'] 
)&lt;/t&gt;
&lt;t tx="leo.20210529155606.1"&gt;&lt;/t&gt;
&lt;t tx="leo.20210529155606.10"&gt;function sysCall_actuation()
 calibration = 0.004
 message,auxiliaryData=sim.getSimulatorMessage()
 if (message==sim.message_keypress) then
      print(auxiliaryData[1])--key
      if (auxiliaryData[1]==string.byte(' ')) then
      end
       --Display keyboard key code
      if (auxiliaryData[1]==97) then --a
      rotation1 = rotation1 + 5*deg
      sim.setJointPosition(axis1, rotation1)
      end
      -- Press the "a" key to turn axis1 5 degrees counterclockwise
      if (auxiliaryData[1]==100) then --d
      rotation1 = rotation1 - 5*deg
      sim.setJointPosition(axis1, rotation1)
      end
      -- Press the "d" key to turn axis1 5 degrees clockwise
      if (auxiliaryData[1]==119) then --w
      rotation2 = rotation2 + 5*deg
      sim.setJointPosition(axis2, rotation2)
      end
       -- Press the "w" key to turn axis2 5 degrees counterclockwise
      if (auxiliaryData[1]==115) then --s
      rotation2 = rotation2 - 5*deg
      sim.setJointPosition(axis2, rotation2)
      end
      -- Press the "s" key to turn axis2 5 degrees clockwise
      if (auxiliaryData[1]==101) then --e
      distance3 = distance3 + calibration
      sim.setJointPosition(axis3, distance3)
      end
      -- Press the "e" key to move down 0.01
      if (auxiliaryData[1]==113) then --q
      distance3 = distance3 - calibration
      sim.setJointPosition(axis3, distance3)
      end
      -- Press the "q" key to move up 0.01
      if (auxiliaryData[1]==122) then --z 
      sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','true')
      end -- Press "z" key to activate the suction pad
      if (auxiliaryData[1]==120) then --x
      sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','false')
      end -- Press "x" key to deactivate the suction pad
      if (auxiliaryData[1]==49) then --1
      V1=43.9242*deg
      V2=66.007*deg
      sim.setJointPosition(axis1, V1)
      sim.setJointPosition(axis2, V2)
      print(0.2,0.7)
      end
      -- Press "1" to go to (0.2, 0.7)
      if (auxiliaryData[1]==50) then --2
      V1=-158.2529*deg
      V2=87.7894*deg
      sim.setJointPosition(axis1, V1)
      sim.setJointPosition(axis2, V2)
      print(-0.3,-0.55)
      end
      -- Press "2" to go to (-0.3,- 0.55)
      
  
 end    


end

&lt;/t&gt;
&lt;t tx="leo.20210529155606.11"&gt;function sysCall_sensing()
    -- put your sensing code here
end&lt;/t&gt;
&lt;t tx="leo.20210529155606.12"&gt;function sysCall_cleanup()
    -- do some clean-up here
end&lt;/t&gt;
&lt;t tx="leo.20210529155606.18"&gt;@path ./
@others
@language lua
@tabwidth -4
&lt;/t&gt;
&lt;t tx="leo.20210529155606.19"&gt;function sysCall_init() 
    s=sim.getObjectHandle('suctionPadSensor')
    l=sim.getObjectHandle('suctionPadLoopClosureDummy1')
    l2=sim.getObjectHandle('suctionPadLoopClosureDummy2')
    b=sim.getObjectHandle('suctionPad')
    suctionPadLink=sim.getObjectHandle('suctionPadLink')

    infiniteStrength=sim.getScriptSimulationParameter(sim.handle_self,'infiniteStrength')
    maxPullForce=sim.getScriptSimulationParameter(sim.handle_self,'maxPullForce')
    maxShearForce=sim.getScriptSimulationParameter(sim.handle_self,'maxShearForce')
    maxPeelTorque=sim.getScriptSimulationParameter(sim.handle_self,'maxPeelTorque')

    sim.setLinkDummy(l,-1)
    sim.setObjectParent(l,b,true)
    m=sim.getObjectMatrix(l2,-1)
    sim.setObjectMatrix(l,-1,m)
end
&lt;/t&gt;
&lt;t tx="leo.20210529155606.2"&gt;&lt;/t&gt;
&lt;t tx="leo.20210529155606.20"&gt;function sysCall_cleanup() 
    sim.setLinkDummy(l,-1)
    sim.setObjectParent(l,b,true)
    m=sim.getObjectMatrix(l2,-1)
    sim.setObjectMatrix(l,-1,m)
end &lt;/t&gt;
&lt;t tx="leo.20210529155606.21"&gt;function sysCall_sensing() 
    parent=sim.getObjectParent(l)
    if (sim.getScriptSimulationParameter(sim.handle_self,'active')==false) then
        if (parent~=b) then
            sim.setLinkDummy(l,-1)
            sim.setObjectParent(l,b,true)
            m=sim.getObjectMatrix(l2,-1)
            sim.setObjectMatrix(l,-1,m)
        end
    else
        if (parent==b) then
            -- Here we want to detect a respondable shape, and then connect to it with a force sensor (via a loop closure dummy dummy link)
            -- However most respondable shapes are set to "non-detectable", so "sim.readProximitySensor" or similar will not work.
            -- But "sim.checkProximitySensor" or similar will work (they don't check the "detectable" flags), but we have to go through all shape objects!
            index=0
            while true do
                shape=sim.getObjects(index,sim.object_shape_type)
                if (shape==-1) then
                    break
                end
                if (shape~=b) and (sim.getObjectInt32Parameter(shape,sim.shapeintparam_respondable)~=0) and (sim.checkProximitySensor(s,shape)==1) then
                    -- Ok, we found a respondable shape that was detected
                    -- We connect to that shape:
                    -- Make sure the two dummies are initially coincident:
                    sim.setObjectParent(l,b,true)
                    m=sim.getObjectMatrix(l2,-1)
                    sim.setObjectMatrix(l,-1,m)
                    -- Do the connection:
                    sim.setObjectParent(l,shape,true)
                    sim.setLinkDummy(l,l2)
                    break
                end
                index=index+1
            end
        else
            -- Here we have an object attached
            if (infiniteStrength==false) then
                -- We might have to conditionally beak it apart!
                result,force,torque=sim.readForceSensor(suctionPadLink) -- Here we read the median value out of 5 values (check the force sensor prop. dialog)
                if (result&gt;0) then
                    breakIt=false
                    if (force[3]&gt;maxPullForce) then breakIt=true end
                    sf=math.sqrt(force[1]*force[1]+force[2]*force[2])
                    if (sf&gt;maxShearForce) then breakIt=true end
                    if (torque[1]&gt;maxPeelTorque) then breakIt=true end
                    if (torque[2]&gt;maxPeelTorque) then breakIt=true end
                    if (breakIt) then
                        -- We break the link:
                        sim.setLinkDummy(l,-1)
                        sim.setObjectParent(l,b,true)
                        m=sim.getObjectMatrix(l2,-1)
                        sim.setObjectMatrix(l,-1,m)
                    end
                end
            end
        end
    end
end 
&lt;/t&gt;
&lt;t tx="leo.20210529155606.8"&gt;@path ./
@others
@language lua
@tabwidth -4
&lt;/t&gt;
&lt;t tx="leo.20210529155606.9"&gt;function sysCall_init()
    -- do some initialization here
     axis1=sim.getObjectHandle('MTB_axis1')
     axis2=sim.getObjectHandle('MTB_axis2')
     axis3=sim.getObjectHandle('MTB_axis3')
     suctionPad=sim.getObjectHandle('suctionPad')     
     rotation1 = 0
     rotation2 = 0
     distance3 = 0
     
     deg = math.pi/180
function ik(x, y)
    theta = ik(0.2, 0.7)
    theta = ik(-0.3, -0.55)
    -- (x, y) need to be located inside the circle with radius a1+a2
    if (x^2 + y^2) &lt;= (a1+ a2)^2 then
        q2 = math.acos((x^2+y^2-a1^2-a2^2)/(2*a1*a2))
        q1 = math.atan2(y, x) - math.atan2((a2*math.sin(q2)), (a1+a2*math.cos(q2)))
        return {round(q1*deg, 4), round(q2*deg, 4)}
    end
    print(theta[1], theta[2])
  
end   
     
    
     

end&lt;/t&gt;
&lt;t tx="leo.20210529215420.1"&gt;Force sensors are initially rigid links between two shapes that are able to measure transmitted forces and torques. The rigidity of force sensors is conditional, in the sense that force sensors can be broken if a certain condition arises (e.g. if a force or torque threshold is overshot). Following figure illustrates an application using a force sensor:

A force sensor is only operational during simulation if it is dynamically enabled. It means the child of the force sensor need to be dynamically enabled.

In CoppeliaSim, only a limited number of objects will be dynamically simulated. Those are shapes, joints and force sensors, but it will depend on the scene structure and object properties, whether a given object will be dynamically simulated. &lt;/t&gt;
&lt;t tx="leo.20210615114721.1"&gt;@path ./
@others
@language lua
@tabwidth -4
&lt;/t&gt;
&lt;t tx="leo.20210615114721.2"&gt;function sysCall_threadmain()
    -- do some initialization here
    axis1=sim.getObjectHandle('MTB_axis1')
    axis2=sim.getObjectHandle('MTB_axis2')
    axis3=sim.getObjectHandle('MTB_axis3')
    suctionPad=sim.getObjectHandle('suctionPad')
    angle=180/math.pi
    angle1=math.pi/180
    a1=0.467
    a2=0.4
    x=0.2
    y=0.7
    print(a)
    function round(x, n)
    n = math.pow(10, n or 0)
    x = x * n
    if x &gt;= 0 then x = math.floor(x + 0.5) else x = math.ceil(x - 0.5) end
    return x / n
end
 
-- radian to degree
deg = 180/math.pi
-- link 1 length
a1 = 0.467
-- link 2 length
a2 = 0.4
-- derivated based upon https://www.youtube.com/watch?v=IKOGwoJ2HLk&amp;t=311s
function ik(x, y)
    -- (x, y) need to be located inside the circle with radius a1+a2
    if (x^2 + y^2) &lt;= (a1+ a2)^2 then
        q2 = math.acos((x^2+y^2-a1^2-a2^2)/(2*a1*a2))
        q1 = math.atan2(y, x) - math.atan2((a2*math.sin(q2)), (a1+a2*math.cos(q2)))
        return {round(q1*deg, 4), round(q2*deg, 4)}
    else
        print("Over range!")
    end
end
 
theta = ik(0.2, 0.7)
 
print(theta[1], theta[2])
            sim.setJointPosition(axis1, 0)
            sim.setJointPosition(axis2, 0)
            sim.wait(5)
    
    while(true)
        do  
            sim.wait(5)
            sim.setJointPosition(axis3, -0.03)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','true')
            sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            theta = ik(0.2, 0.7)
            sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            sim.setJointPosition(axis1,theta[1]*angle1)
            sim.setJointPosition(axis2,theta[2]*angle1)
            sim.wait(10)
            
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','false')
            sim.wait(5)
            sim.setJointPosition(axis3,0.01)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','ture')
            sim.wait(5)
            sim.setJointPosition(axis3,-0.03)
             sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            sim.wait(10)
            theta = ik(-0.3, -0.55)
             sim.setJointPosition(axis3, 0.01)
            sim.setJointPosition(axis1,theta[1]*angle1)
            sim.setJointPosition(axis2,theta[2]*angle1)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','false')
            sim.wait(5)
            sim.setJointPosition(axis3,0.01)

    end   
    
    
    
end
&lt;/t&gt;
&lt;/tnodes&gt;
&lt;/leo_file&gt;
</pre>
<p><strong><iframe allowfullscreen="allowfullscreen" height="314" src="//www.youtube.com/embed/swlLFBmwCfo" width="560"></iframe></strong></p>
<p><strong>Mtb_robot_loop.lua:</strong></p>
<pre class="brush:lua;auto-links:false;toolbar:false" contenteditable="false">function sysCall_threadmain()
    -- do some initialization here
    axis1=sim.getObjectHandle('MTB_axis1')
    axis2=sim.getObjectHandle('MTB_axis2')
    axis3=sim.getObjectHandle('MTB_axis3')
    suctionPad=sim.getObjectHandle('suctionPad')
    angle=180/math.pi
    angle1=math.pi/180
    a1=0.467
    a2=0.4
    x=0.2
    y=0.7
    print(a)
    function round(x, n)
    n = math.pow(10, n or 0)
    x = x * n
    if x &gt;= 0 then x = math.floor(x + 0.5) else x = math.ceil(x - 0.5) end
    return x / n
end
 
-- radian to degree
deg = 180/math.pi
-- link 1 length
a1 = 0.467
-- link 2 length
a2 = 0.4
-- derivated based upon https://www.youtube.com/watch?v=IKOGwoJ2HLk&amp;t=311s
function ik(x, y)
    -- (x, y) need to be located inside the circle with radius a1+a2
    if (x^2 + y^2) &lt;= (a1+ a2)^2 then
        q2 = math.acos((x^2+y^2-a1^2-a2^2)/(2*a1*a2))
        q1 = math.atan2(y, x) - math.atan2((a2*math.sin(q2)), (a1+a2*math.cos(q2)))
        return {round(q1*deg, 4), round(q2*deg, 4)}
    else
        print("Over range!")
    end
end
 
theta = ik(0.2, 0.7)
 
print(theta[1], theta[2])
            sim.setJointPosition(axis1, 0)
            sim.setJointPosition(axis2, 0)
            sim.wait(5)
    
    while(true)
        do  
            sim.wait(5)
            sim.setJointPosition(axis3, -0.03)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','true')
            sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            theta = ik(0.2, 0.7)
            sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            sim.setJointPosition(axis1,theta[1]*angle1)
            sim.setJointPosition(axis2,theta[2]*angle1)
            sim.wait(10)
            
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','false')
            sim.wait(5)
            sim.setJointPosition(axis3,0.01)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','ture')
            sim.wait(5)
            sim.setJointPosition(axis3,-0.03)
             sim.wait(5)
            sim.setJointPosition(axis3, 0.01)
            sim.wait(10)
            theta = ik(-0.3, -0.55)
             sim.setJointPosition(axis3, 0.01)
            sim.setJointPosition(axis1,theta[1]*angle1)
            sim.setJointPosition(axis2,theta[2]*angle1)
            sim.wait(5)
            sim.setScriptSimulationParameter(sim.getScriptAssociatedWithObject(suctionPad),'active','false')
            sim.wait(5)
            sim.setJointPosition(axis3,0.01)

    end   
    
    
    
end
</pre>
<p></p><br />手臂末端加入 components-gripper-suction pad 吸盤 << <a href='手臂末端加入 components-gripper-suction pad 吸盤.html'>Previous</a> <a href='Python remote API 逆向運動學函式.html'>Next</a> >> Python remote API 逆向運動學函式</div>
        
    <!-- footer -->
      <div class="container">
        <div class="row pt-3 mx-auto">
            <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank" >Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
        </div>
      </div>
    <!-- for footer -->
    
        </div> <!-- for site wrap -->
            <!-- <script src="../cmsimde/static/chimper/js/jquery-3.3.1.min.js"></script> -->
            <script src="../cmsimde/static/chimper/js/jquery-migrate-3.0.1.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery-ui.js"></script>
            <script src="../cmsimde/static/chimper/js/popper.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap.min.js"></script>
            <script src="../cmsimde/static/chimper/js/owl.carousel.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.stellar.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.countdown.min.js"></script>
            <script src="../cmsimde/static/chimper/js/jquery.magnific-popup.min.js"></script>
            <script src="../cmsimde/static/chimper/js/bootstrap-datepicker.min.js"></script>
            <script src="../cmsimde/static/chimper/js/aos.js"></script>
            <!--
            <script src="../cmsimde/static/chimper/js/typed.js"></script>
                    <script>
                    var typed = new Typed('.typed-words', {
                    strings: ["Web Apps"," WordPress"," Mobile Apps"],
                    typeSpeed: 80,
                    backSpeed: 80,
                    backDelay: 4000,
                    startDelay: 1000,
                    loop: true,
                    showCursor: true
                    });
                    </script>
            -->
            <script src="../cmsimde/static/chimper/js/main.js"></script>
        
<!-- 啟用 LaTeX equations 編輯 -->
  <!-- <script>
  MathJax = {
    tex: {inlineMath: [['$', '$'], ['\(', '\)']]}
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>-->
    </body></html>
        